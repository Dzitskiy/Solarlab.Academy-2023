@page

<script>
    function continueToChat()
    {
        $('#spn-nickname').text($('#nickname').val());
        $('#entrance').hide();
        $('#chat').show();
    }

</script>

<div class="from-group">
    &nbsp;
</div>

<div id="entrance">
    <label for="nickname">Введите имя:</label>
    <input type="text" id="nickname" />
    <buttn onclick="continueToChat()">Продолжить</buttn>
</div>

<div id="chat" style="display: none">
    <h3 id="spn-nickname"></h3>
    <form id="frm-send-message" action="#">
        <label for="message">Текст сообщения:</label>
        <input type="text" id="message" />
        <input type="submit" id="send" value="Отправить" class="send"/>
    </form>
    <div class="clear"></div>
    <ul id="messages"></ul>
</div>

<script src="~/lib/signalr/signalr.min.js"></script>

<script>

    const connection = new signalR.HubConnectionBuilder()
    .withUrl("/Chat")
    .build();

    connection.start().catch(err => connection.error(err.toString()));

    connection.on('Send', (nickname, message) => {
        appendLine(nickname, message);
    });

    document.getElementById('frm-send-message').addEventListener('submit', event => {
        let message = $('#message').val();
        let nickname = $('#nickname').val();

        $('#message').val('');

        connection.invoke('Send', nickname, message);
        event.preventDefault();    
    });

    function appendLine(nickname, message, color)
    {
        let nameElement = document.createElement('strong');
        nameElement.innerText = `${nickname}:`;

        let msgElement = document.createElement('em');
        msgElement.innerText = `${message}:`;

        let li = document.createElement('li');
        li.appendChild(nameElement);
        li.appendChild(msgElement);

        $('#message').append(li);
    };

</script>